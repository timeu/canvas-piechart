<link rel="import" href="../polymer/polymer.html">

<!--
The `canvas-piechart` element draws a piechart on a HTML5 Canvas

Example:

    <canvas-piechart size="50" data="[10,20,40,50]"></canvas-piechart>

@demo
@element canvas-piechart
@blurb Draws a piechart on a HTMl5 Canvas.
@status alpha
@homepage http://timeu.github.io/canvas-piechart
-->
<dom-module id="canvas-piechart">
    <template>
        <canvas id="canvas" width$="[[size]]" height$="[[size]]" />
    </template>
</dom-module>

<script>
(function() {

  var DEFAULT_COLORS16 = [
    '#f44336',
    '#e91e63',
    '#9c27b0',
    '#673ab7',
    '#3f51b5',
    '#1e88e5',
    '#03a9f4',
    '#00bcd4',
    '#009688',
    '#4caf50',
    '#8bc34a',
    '#cddc39',
    '#ffeb3b',
    '#ffc107',
    '#ff9800',
    '#ff5722'
  ];
  var DEFAULT_COLORS8 = [
    '#f44336',
    '#9c27b0',
    '#3f51b5',
    '#03a9f4',
    '#009688',
    '#8bc34a',
    '#ffeb3b',
    '#ff9800'
  ];
  var DEFAULT_COLORS4 = [
    '#f44336',
    '#3f51b5',
    '#8bc34a',
    '#ffeb3b',
  ];

  Polymer({

    is: 'canvas-piechart',

    properties: {
      /**
      * The `colors` attribute specifies the colors to be used for each slice.
      * If no colors are specified then the default-colors are used.
      *
      * @attribute colors
      */
      colors: {
        type:Array,
        value: function() { return []; }
      },

      /**
      * The `size` property specifies the size of the piechart (Default: 50).
      *
      * @attribute size
      */
      size: {
        type:Number,
        value:50
      },

      /**
       * The `data` property specifies the values for each slice .
       *
       * @attribute data
      */
      data : {
        type:Array,
        value: function() { return []; }
      }
    },
    observers: [
      'render(colors,data,size)'
    ],
    _getCtx : function() {
        if (!this._ctx) {
          this._ctx = this.$.canvas.getContext("2d");
        }
        return this._ctx;
    },
    _getColors : function(colors) {
      if (!colors || colors.length == 0) {
        if (this.data.length > 8) {
          colors = DEFAULT_COLORS16;
        }
        else if (this.data.length > 4) {
          colors = DEFAULT_COLORS8;
        }
        else {
          colors = DEFAULT_COLORS4;
        }
      }
      return colors;
    },
    _calculateTotal: function() {
      var total = 0;
      for (var i =0;i<this.data.length;i++) {
        total += this.data[i];
      }
      return total;
    },
    render : function() {
      var ctx = this._getCtx();
      if (!ctx)
        return;
      ctx.clearRect(0, 0, this.size,this.size);
      var colors = this._getColors(colors);
      var radius = this.size/2;
      var lastend = 1.5 * Math.PI;
      var total = this._calculateTotal();
      for (var i = 0; i < this.data.length; i++) {
        var slice = this.data[i];
        var arcDest = Math.PI * 2 * (slice / total);
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.moveTo(radius, radius);
        ctx.arc(radius, radius, radius, lastend, lastend + (arcDest), false);
        ctx.lineTo(radius, radius);
        ctx.fill();
        lastend += arcDest;
      }
    }
  });
})();

</script>


